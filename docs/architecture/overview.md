# üèóÔ∏è Visi√≥n General de la Arquitectura

Quick Question est√° construido con una arquitectura moderna, escalable y mantenible que prioriza la experiencia en tiempo real y la separaci√≥n de responsabilidades.

---

## üìê Diagrama de Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FRONTEND (React)                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ   HomePage   ‚îÇ  ‚îÇ PlayerView   ‚îÇ  ‚îÇModeratorView ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                  ‚îÇ                  ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                          ‚îÇ                                      ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ         ‚îÇ                                  ‚îÇ                    ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ    ‚îÇ  Store  ‚îÇ                     ‚îÇ Services  ‚îÇ              ‚îÇ
‚îÇ    ‚îÇ(Zustand)‚îÇ                     ‚îÇ           ‚îÇ              ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                                         ‚îÇ                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ                      ‚îÇ
‚îÇ                    EXTERNAL SERVICES    ‚îÇ                      ‚îÇ
‚îÇ                                         ‚îÇ                      ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îê                   ‚îÇ
‚îÇ         ‚îÇ                                  ‚îÇ                   ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ    ‚îÇ   Firebase  ‚îÇ                ‚îÇ   Gemini AI    ‚îÇ         ‚îÇ
‚îÇ    ‚îÇ  Realtime   ‚îÇ                ‚îÇ   (Google)     ‚îÇ         ‚îÇ
‚îÇ    ‚îÇ  Database   ‚îÇ                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Principios de Dise√±o

### 1. **Separaci√≥n de Responsabilidades**
Cada capa tiene una responsabilidad clara y bien definida:

- **Presentaci√≥n**: Componentes React (UI/UX)
- **L√≥gica de Negocio**: Services (game, question, gemini)
- **Estado Global**: Zustand Store
- **Persistencia**: Firebase Realtime Database
- **IA**: Gemini AI API

### 2. **Tiempo Real First**
Todo el sistema est√° dise√±ado para actualizaciones en tiempo real:

```typescript
// Suscripci√≥n a cambios en Firebase
subscribeToGame(gameId, (game) => {
  setGameState(game); // Actualizaci√≥n autom√°tica
});
```

### 3. **Offline-Ready con Fallback**
Si Gemini AI falla, el sistema usa un banco de preguntas local:

```typescript
try {
  return await generateQuestionWithAI();
} catch {
  return generateQuestionFromBank(); // Fallback
}
```

### 4. **Type Safety**
TypeScript en todo el proyecto para prevenir errores:

```typescript
interface GameState {
  id: string;
  code: string;
  players: Record<string, Player>;
  status: 'lobby' | 'playing' | 'waiting-for-buzzer' | 'finished';
  // ...
}
```

---

## üîÑ Flujo de Datos

### Creaci√≥n de Juego

```
Moderator View ‚Üí createGame() ‚Üí Firebase
                     ‚Üì
              gameId generado
                     ‚Üì
           subscribeToGame()
                     ‚Üì
      Actualizaci√≥n autom√°tica
```

### Unirse al Juego

```
Player View ‚Üí joinGame(code) ‚Üí Firebase
                  ‚Üì
           Buscar por c√≥digo
                  ‚Üì
        Agregar a players{}
                  ‚Üì
       Todos reciben update
```

### Generaci√≥n de Pregunta

```
Moderator ‚Üí generateQuestion()
                  ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                 ‚îÇ
    Gemini AI       Banco Est√°tico
         ‚îÇ                 ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üì
          updateCurrentQuestion()
                  ‚Üì
              Firebase
                  ‚Üì
    Todos ven la nueva pregunta
```

---

## üß© Componentes Principales

### Frontend (React)

#### **Vistas**
- `HomePage.tsx` - Landing y selecci√≥n de rol
- `CreateGamePage.tsx` - Configuraci√≥n de nueva partida
- `ModeratorView.tsx` - Panel de control del moderador
- `PlayerView.tsx` - Interfaz del jugador
- `SpectatorView.tsx` - Vista de observador

#### **Componentes UI**
- `Button.tsx` - Bot√≥n reutilizable
- `Card.tsx` - Tarjeta contenedora
- `Input.tsx` - Campo de entrada

### Services (L√≥gica)

#### **gameService.ts**
Maneja todas las operaciones del juego:
- Crear/unir partidas
- Actualizar estado
- Gestionar turnos
- Sistema de buzzer

#### **questionService.ts**
Genera y gestiona preguntas:
- Banco de preguntas est√°ticas
- Sistema anti-repetici√≥n
- Selecci√≥n por categor√≠a/dificultad

#### **geminiService.ts**
Integraci√≥n con Gemini AI:
- Generaci√≥n din√°mica de preguntas
- Parsing de respuestas JSON
- Manejo de errores

### Store (Estado Global)

```typescript
interface GameStore {
  gameId: string | null;
  playerId: string | null;
  playerRole: 'player' | 'moderator' | null;
  gameState: GameState | null;
  currentPlayer: Player | null;
}
```

---

## üîå Integraciones Externas

### Firebase Realtime Database

**Prop√≥sito**: Base de datos NoSQL en tiempo real

**Caracter√≠sticas Utilizadas**:
- Sincronizaci√≥n autom√°tica
- Listeners en tiempo real
- Estructura JSON
- Offline persistence (built-in)

**Endpoints**:
```
/games/{gameId}
  ‚îú‚îÄ id
  ‚îú‚îÄ code
  ‚îú‚îÄ status
  ‚îú‚îÄ players/
  ‚îú‚îÄ currentQuestion
  ‚îî‚îÄ settings
```

### Gemini AI API

**Prop√≥sito**: Generaci√≥n de preguntas con IA

**Modelo**: `gemini-2.5-flash`

**Endpoint**:
```
POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent
```

**Request**:
```json
{
  "contents": [{
    "parts": [{
      "text": "Genera una pregunta de trivia..."
    }]
  }],
  "generationConfig": {
    "temperature": 0.9,
    "topK": 40,
    "topP": 0.95
  }
}
```

---

## üöÄ Tecnolog√≠as Clave

| Tecnolog√≠a | Prop√≥sito | Versi√≥n |
|------------|-----------|---------|
| React | UI Framework | 18.3.1 |
| TypeScript | Type Safety | 5.5.4 |
| Vite | Build Tool | 5.4.2 |
| Tailwind CSS | Estilos | 3.4.10 |
| Zustand | Estado Global | 4.5.5 |
| Firebase | Backend/DB | 10.13.0 |
| React Router | Routing | 6.26.0 |
| Lucide React | Iconos | 0.436.0 |

---

## üì¶ Estructura de Carpetas

```
src/
‚îú‚îÄ‚îÄ components/        # Componentes reutilizables
‚îÇ   ‚îî‚îÄ‚îÄ ui/           # Componentes base (Button, Card, Input)
‚îú‚îÄ‚îÄ lib/              # Utilidades y configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ firebase.ts   # Config de Firebase
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts      # Funciones utilitarias
‚îú‚îÄ‚îÄ pages/            # Vistas principales
‚îÇ   ‚îú‚îÄ‚îÄ HomePage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ CreateGamePage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ModeratorView.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PlayerView.tsx
‚îÇ   ‚îî‚îÄ‚îÄ SpectatorView.tsx
‚îú‚îÄ‚îÄ services/         # L√≥gica de negocio
‚îÇ   ‚îú‚îÄ‚îÄ gameService.ts
‚îÇ   ‚îú‚îÄ‚îÄ questionService.ts
‚îÇ   ‚îî‚îÄ‚îÄ geminiService.ts
‚îú‚îÄ‚îÄ store/            # Estado global
‚îÇ   ‚îî‚îÄ‚îÄ gameStore.ts
‚îú‚îÄ‚îÄ types/            # Tipos TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ game.ts
‚îú‚îÄ‚îÄ App.tsx           # Componente ra√≠z
‚îú‚îÄ‚îÄ main.tsx          # Entry point
‚îî‚îÄ‚îÄ index.css         # Estilos globales
```

---

## üîê Seguridad

### Protecci√≥n de API Keys

```typescript
// ‚úÖ Correcto: Variables de entorno
const API_KEY = import.meta.env.VITE_GEMINI_API_KEY;

// ‚ùå Incorrecto: Hardcoded
const API_KEY = "AIzaSy..."; // ¬°NO HACER!
```

### Firebase Rules

```json
{
  "rules": {
    "games": {
      "$gameId": {
        ".read": true,
        ".write": "!data.exists() || data.child('moderatorId').val() === auth.uid"
      }
    }
  }
}
```

### Validaci√≥n de Datos

```typescript
// Validar entrada del usuario
const validateGameCode = (code: string): boolean => {
  return /^[A-Z0-9]{6}$/.test(code);
};
```

---

## üéØ Escalabilidad

### Horizontal

- **Firebase**: Escala autom√°ticamente
- **Vercel**: Edge functions y CDN global
- **Gemini AI**: Rate limiting incorporado

### Vertical

- **Code Splitting**: Vite divide el c√≥digo autom√°ticamente
- **Lazy Loading**: Componentes cargados bajo demanda
- **Memoization**: React.memo para optimizaci√≥n

```typescript
const PlayerView = React.memo(() => {
  // Componente optimizado
});
```

---

## üîÑ Ciclo de Vida de una Partida

```
1. CREAR JUEGO
   Moderator ‚Üí createGame() ‚Üí Firebase

2. UNIRSE
   Players ‚Üí joinGame(code) ‚Üí Firebase
   
3. INICIAR
   Moderator ‚Üí startGame() ‚Üí status: 'playing'
   
4. JUGAR
   Loop:
     - generateQuestion()
     - updateCurrentQuestion()
     - Jugador responde
     - updatePlayerScore()
     - nextRound()
   
5. FINALIZAR
   round > maxRounds ‚Üí status: 'finished'
   
6. RESULTADOS
   Mostrar ganador y estad√≠sticas
```

---

## üìä M√©tricas y Monitoreo

### Performance

- **Tiempo de carga inicial**: < 2s
- **Sincronizaci√≥n en tiempo real**: < 100ms
- **Generaci√≥n de pregunta (Gemini)**: 2-5s
- **Generaci√≥n de pregunta (Local)**: < 10ms

### Disponibilidad

- **Firebase uptime**: 99.95%
- **Vercel uptime**: 99.99%
- **Fallback local**: 100% (siempre disponible)

---

## üîó Pr√≥ximos Pasos

Para profundizar en aspectos espec√≠ficos:

- [Estructura del Proyecto](./project-structure.md)
- [Flujo de Datos Detallado](./data-flow.md)
- [Stack Tecnol√≥gico](./tech-stack.md)
- [Servicios y APIs](../api/)

---

**¬øPreguntas sobre la arquitectura?** Consulta los documentos espec√≠ficos o abre un [issue en GitHub](https://github.com/davidB2ya/Quick-Question/issues).
